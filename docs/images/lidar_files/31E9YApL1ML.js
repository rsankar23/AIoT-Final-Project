'use strict';(function(f){var p=window.AmazonUIPageJS||window.P,v=p._namespace||p.attributeErrors,d=v?v("UdmRefreshAssets",""):p;d.guardFatal?d.guardFatal(f)(d,window):d.execute(function(){f(d,window)})})(function(f,p,v){f.when("A","udm-refresh-manager","quantity-dropdown-constants","udm-metrics-publisher","udm-amount-refresh").execute("quantity-dropdown-udm-refresh",function(d,b,a,r,c){function g(){n(a.SELECTORS.DELIVERY_BLOCK_AJAX_PARAMS).toArray().map(function(a){return m(a)}).forEach(function(a){return b.registerFeature(h,
{successHandler:l,failureHandler:q},a)})}function m(h){return h?Number(h.getAttribute(a.HTML_ATTRIBUTES.AUI_PAGE_STATE).match(a.REGEX.DELIVERY_BLOCK_AJAX_PARAMS)[1]):NaN}var n=d.$,h={featureName:a.FEATURE_REGISTRATION.NAME,featureAttribution:a.FEATURE_REGISTRATION.CTI,mandatoryParams:{quantity:"1"}},l=function(){r.logMetric(a.METRICS.QTY_REFRESH_SUCCESS)},q=function(){r.logMetric(a.METRICS.QTY_REFRESH_FAILURE)};d.on(a.EVENTS.PAGE_UPDATE,function(){g()});g();n(a.SELECTORS.QUANTITY_DROPDOWN).live("change",
function(h){try{if(!h.updateUdmOnQuantityChange){h.updateUdmOnQuantityChange=1;var d=n(this).val(),l={quantity:String(parseInt(d,10))},e;if(e=c.isEnabled){var g=this.closest("form")||this.closest("#buybox");if(g){var t=g.querySelector(a.SELECTORS.DIMENSION_INPUT);e=t&&t.value===a.DIMENSIONS.WEIGHT}else e=!1}e&&(l.amount=d,l.quantity="1");var y=n(this).closest(a.SELECTORS.ACCORDION_ROW),k=m(y.find(a.SELECTORS.DELIVERY_BLOCK_AJAX_PARAMS)[0]);isNaN(k)||b.refresh({featureName:a.FEATURE_REGISTRATION.NAME},
l,k)}}catch(z){f.log("Quantity Dropdown UDM Refresh Failed with ERROR: "+z,"ERROR","QuantityDropdown"),r.logMetric(a.METRICS.QTY_REFRESH_FAILURE)}})});"use strict";f.register("quantity-dropdown-constants",function(){return{FEATURE_REGISTRATION:{NAME:"QUANTITY",CTI:"Website/DEX Evaluation/Alternative Offer Eligibility Message"},EVENTS:{PAGE_UPDATE:"a:pageUpdate"},SELECTORS:{DELIVERY_BLOCK_AJAX_PARAMS:"script[data-a-state*\x3d'delivery-block-ajax-params']",ACCORDION_ROW:'\'[id$\x3d"AccordionRow"], #buybox, [id^\x3d"newAccordionRow"]\'',
QUANTITY_DROPDOWN:"#selectQuantity [name\x3d'quantity'], #mobileQuantityDropDown",DIMENSION_INPUT:'input[name\x3d"items[0.base][unitOfMeasureQuantity][unitOfMeasure][dimension]"]'},REGEX:{DELIVERY_BLOCK_AJAX_PARAMS:/delivery-block-ajax-params-(\d+)/},HTML_ATTRIBUTES:{AUI_PAGE_STATE:"data-a-state"},DIMENSIONS:{WEIGHT:"WEIGHT"},METRICS:{QTY_REFRESH_SUCCESS:"UDM-REFRESH-QUANTITY-SUCCESS",QTY_REFRESH_FAILURE:"UDM-REFRESH-QUANTITY-FAILURE"}}});"use strict";f.when("A").register("udm-refresh-allowlisted-features",
function(d){var b={QUANTITY:{mandatoryParams:["quantity"],optionalParams:["amount"]},SERVICE_OPTIONS:{mandatoryParams:["vas"]}};return{get:function(){return Object.keys(b)},getMandatoryParamsForFeature:function(a){return b[a].mandatoryParams},getOptionalParamsForFeature:function(a){return b[a].optionalParams||[]},getMandatoryParamsForAllFeatures:function(){var a=[];d.each(b,function(b){a=a.concat(b.mandatoryParams)});return a}}});"use strict";f.when("A","udm-refresh-allowlisted-features","udm-metrics-publisher").register("udm-refresh-feature-registration",
function(d,b,a){function r(a){var h=!0;d.each(b.getMandatoryParamsForFeature(a.featureName),function(b){a.mandatoryParams.hasOwnProperty(b)||(f.log("FeatureData is missing the mandatoryParam "+b,"ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),h=!1)});return h}function c(a){return a.featureName+" (C/T/I: "+a.featureAttribution+")"}function g(h,b){a.logMetric(h);a.logMetricWithSuffix(h,b)}var m={},n=["featureName","featureAttribution","mandatoryParams"];return{registerFeature:function(a,
l,q){var e;a:{for(e=0;e<n.length;e++){var h=n[e];if(!a.hasOwnProperty(h)){f.log("UDM Refresh Manager: Feature Registration does not contain valid mandatory attribute: "+h,"ERROR",a);g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName);e=!1;break a}}e=!0}if(!e)return!1;if(0>q)return f.log("UDM Refresh Manager: BuyingOptionIndex can not be less than 0","ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),!1;-1===b.get().indexOf(a.featureName)?(f.log("UDM Refresh Manager: Feature name is not allowlisted",
"ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),e=!1):e=!0;if(!e||!r(a))return!1;e=m.hasOwnProperty(q)&&m[q].hasOwnProperty(a.featureName)?!0:!1;if(e)return!1;l.hasOwnProperty("successHandler")&&l.hasOwnProperty("failureHandler")?"function"!==typeof l.successHandler||"function"!==typeof l.failureHandler?(f.log("UDM Refresh Manager: Callbacks are not of type function","ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),e=!1):e=!0:(f.log("UDM Refresh Manager: Functions missing in callbacks passed",
"ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),e=!1);if(!e)return!1;e={};h=a.featureName;l={featureName:a.featureName,featureAttribution:a.featureAttribution,callbacks:l,mandatoryParams:a.mandatoryParams,optionalParams:a.optionalParams};h in e?Object.defineProperty(e,h,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[h]=l;m.hasOwnProperty(q)||(m[q]={});d.extend(m[q],e);g("UDM-FEATURE-REGISTRATION-REQUEST-SUCCESS",a.featureName);return!0},getDataForFeature:function(a,
b){return m.hasOwnProperty(b)&&m[b].hasOwnProperty(a)?m[b][a]:null},getRegisteredFeatures:function(a){return Object.keys(m[a])}}});"use strict";f.when("A","udm-refresh-framework").register("udm-refresh-manager",function(d,b){return{refresh:function(a,d,c){return b.refresh(a,d,c)},registerFeature:function(a,d,c){return b.registerFeature(a,d,c)}}});"use strict";f.when("A","udm-refresh-feature-registration","udm-gxa-handler","udm-refresh-dom-accessor","udm-refresh-allowlisted-features","udm-metrics-publisher",
"udm-glow-cip-migration-weblab").register("udm-refresh-framework",function(d,b,a,r,c,g,m){function n(a,b,k){if(!a.hasOwnProperty("featureName"))return f.log("UDM Refresh Manager: Feature data passed to UDM refresh manager without featureName property","ERROR",k),g.logMetric("UDM-REFRESH-REQUEST-INVALID"),!1;if(0>k)return f.log("UDM Refresh Manager: buyingOptionIndex cannot be less than zero.","ERROR",a.featureName),u("UDM-REFRESH-REQUEST-INVALID",a.featureName),!1;var t=!0;d.each(c.getMandatoryParamsForFeature(a.featureName),
function(d){b.hasOwnProperty(d)||(f.log("UDM Refresh Manager: mandatory param: "+d+" is not present in request data.","ERROR",a.featureName),u("UDM-REFRESH-REQUEST-INVALID",a.featureName),t=!1)});return t}function h(a,b){return null==b||"undefined"===typeof b.asin?(f.log("UDM Refresh Manager: Refresh triggered for a buybox type which does not have the page state","ERROR",a.featureName),u("UDM-REFRESH-REQUEST-INVALID",a.featureName),!1):!0}function l(a,b,k,c){b=p(a,b);a=q(a,k);k={asin:c.asin,merchantId:c.merchantId,
exclusiveMerchantId:c.merchantId};m.isEnabled&&(k.deviceType=c.deviceType);null!=c.offerListingId&&(k.offerListingId=c.offerListingId);null!=c.locale&&(k.language=c.locale);return{gxaParams:d.extend({},x,k,a,b),featureStateToPersist:b}}function q(a,c){var k={},t=w[c];d.each(b.getRegisteredFeatures(c),function(b){b!==a&&d.extend(k,e(t,b,c))});return k}function e(a,c,d){return a&&a.hasOwnProperty(c)?a[c]:b.getDataForFeature(c,d).mandatoryParams}function p(a,b){var k={},e=c.getMandatoryParamsForFeature(a);
d.each(e,function(a){k[a]=b[a]});a=c.getOptionalParamsForFeature(a);d.each(a,function(a){b[a]!==v&&(k[a]=b[a])});return k}function u(a,b){g.logMetric(a);g.logMetricWithSuffix(a,b)}var w={},x={clientId:"retailwebsite",deviceType:"web",showFeatures:"udmRefreshFeatures,deliveryBlock,priceBlockMs3Mir",ie:"UTF8",experienceId:"udmRefreshAjaxExperience"};return{registerFeature:function(a,c,d){return b.registerFeature(a,c,d)},refresh:function(c,d,e){if(!n(c,d,e))return!1;var f=r.getDeliveryBlockPageState(e);
if(!h(c,f))return!1;var g=l(c.featureName,d,e,f);a.fetchContentFromGxa(g.gxaParams).then(function(a){var d=g.featureStateToPersist;r.updatePage(e,a);w.hasOwnProperty(e)||(w[e]={});w[e][c.featureName]=d;u("UDM-REFRESH-REQUEST-SUCCESS",c.featureName);b.getDataForFeature(c.featureName,e).callbacks.successHandler()}).catch(function(a){u("UDM-REFRESH-REQUEST-FAILURE",c.featureName);b.getDataForFeature(c.featureName,e).callbacks.failureHandler()});return!0}}});"use strict";f.when("A").register("udm-refresh-dom-accessor",
function(d){var b=d.$;return{getDeliveryBlockPageState:function(a){a=b('script[data-a-state\x3d\'{"key":"delivery-block-ajax-params-'+a+"\"}']").text();return JSON.parse(a)},updatePage:function(a,d){var c=document.createElement("div");c.innerHTML=d;a=b('script[data-a-state\x3d\'{"key":"delivery-block-ajax-params-'+a+"\"}']").closest('[id$\x3d"AccordionRow"], #buybox, [id^\x3d"newAccordionRow"]');d=c.querySelector("#deliveryBlockSmallMessage");b(a).find("#deliveryBlockSmallMessage").replaceWith(d);
d=c.querySelector("#deliveryBlockMessage");b(a).find("#deliveryBlockMessage").replaceWith(d);c=c.querySelector("#primeBadge-ajax-feature");b(a).find("#priceBadging_feature_div").replaceWith(c);if(1===b("#buyBoxAccordion, #buybox").children().length||a.attr("id").match(/^newAccordionRow/))b("#price #priceblock_ourprice_row #ourprice_shippingmessage #priceBadging_feature_div").replaceWith(c),b("#newOfferShippingMessage_feature_div #ourPrice_availability #priceBadging_feature_div").replaceWith(c),b("#price #priceblock_saleprice_row #saleprice_shippingmessage #priceBadging_feature_div").replaceWith(c),
b("#price #priceblock_dealprice_row #dealprice_shippingmessage #priceBadging_feature_div").replaceWith(c)}}});"use strict";f.when("A").register("udm-metrics-publisher",function(d){function b(a,b){"undefined"!==typeof p.ue&&"undefined"!==typeof p.ue.count&&(null==b?p.ue.count(a,(ue.count(a)||0)+1):p.ue.count(a,b))}return{logMetric:b,logLatency:function(a,d,c){null==c&&(c=(new Date).getTime());b(a,c-d)},logMetricWithSuffix:function(a,d){b(a+"-"+d)}}});"use strict";f.when("A","3p-promise","udm-refresh-gxa-flow-migration-weblab",
"udm-metrics-publisher").register("udm-gxa-handler",function(d,b,a,f){function c(b){return(a.isEnabled?"/gp/product/ajax/udmRefreshAjaxExperience":"/gp/product/ajax")+"?"+Object.keys(b).map(function(a){return a+"\x3d"+b[a]}).join("\x26")}return{fetchContentFromGxa:function(a){var g=c(a),n=(new Date).getTime();return new b(function(a,b){d.get(g,{timeout:"10000",contentType:"application/x-www-form-urlencoded;charset\x3dutf-8",dataType:"html",success:function(c){null==c||0===c.trim().length?(f.logLatency("UDM-GXA-NULL-RESPONSE-LATENCY",
n),b(Error("EMPTY_RESPONSE_ERROR_MESSAGE"))):(f.logLatency("UDM-GXA-CALL-SUCCESS-LATENCY",n),a(c.trim()))},error:function(a){f.logLatency("UDM-GXA-CALL-FAILURE-LATENCY",n);b(a)}})})}}});"use strict";f.register("udm-refresh-gxa-flow-migration-weblab",function(){return{isEnabled:!0}});"use strict";f.register("udm-glow-cip-migration-weblab",function(){return{isEnabled:!1}});"use strict";f.register("udm-amount-refresh",function(){return{isEnabled:!0}})});