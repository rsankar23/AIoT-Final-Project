window.aui.amd_define("@amzn/webflow-js",["exports","@amzn/kata-web-framework-external-config","@amzn/kata-web-framework-external-composed","@amzn/webflow-js-register-view-model-mapper","@amzn/kata-web-framework-rxjs-adapter","@amzn/webflow-rx","@amzn/kata-web-framework-patch"],function(O,Ue,Ve,Ne,qe,b,We){"use strict";function Le(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:()=>t[r]})}}return e.default=t,Object.freeze(e)}const Z=Le(We);function Je(t,e){pe.registerFunction(t,e)}function ze(t,e){return pe.invokeFunction(t,e)}const Q=["WebFlowJsUrlParameters","pageHostOverride","showInsight","tinkerId","auiDebug"],He=["showInsight"];function X(){if(Ke()||Ge())return!0;const t=new URLSearchParams(window.location.search);for(const e of He)if(t.has(e))return!0;return!1}function Ge(){return window.location.href.includes("webflow-preview")}function Ke(){return window.location.href.includes("localhost")}const y=(...t)=>{X()&&console.log(...t)},ee=(...t)=>{X()&&console.warn(...t)},Ye=(t,e)=>{X()&&console.error(t,e)},ge=(t,e,r)=>{if(window.ueLogError){const n=r||new Error(e);window.ueLogError(n,{logLevel:t,attribution:"webflow_js",message:"WebFlowJS: "+e}),Ye(e,n)}},C=(t,e)=>ge("ERROR",t,e),B=(t,e)=>ge("FATAL",t,e);let j;const Ze=({messages:t,toastPosition:e})=>{t.subscribe(r=>{var a,s,u,c;y(`showToast: ${r}`);const n=document.createElement("div");n.id="toast",n.style.position="fixed",n.style.bottom=((a=e==null?void 0:e.web)==null?void 0:a.bottom)??"75px",n.style.left=((s=e==null?void 0:e.web)==null?void 0:s.left)??"50%",n.style.right=((u=e==null?void 0:e.web)==null?void 0:u.right)??"auto",n.style.top=((c=e==null?void 0:e.web)==null?void 0:c.top)??"auto",n.style.transform="translateX(-50%)",n.style.display="flex",n.style.width="100%",n.style.flexDirection="row",n.style.alignItems="center",n.style.zIndex="9999",n.style.alignSelf="center",n.style.justifyContent="center",n.style.padding="16px",n.style.backgroundColor="#0F1111",n.style.borderRadius="8px",j==null||j(),j=()=>{n.remove(),j=void 0};const o=document.createElement("span");o.textContent=r,o.style.textAlign="left",o.style.lineHeight="20px",o.style.flex="6",o.style.fontSize="16",o.style.fontWeight="400",o.style.color="#FFFFFF",n.appendChild(o),document.body.appendChild(n),setTimeout(()=>{n&&n.remove()},2400)})},Qe="<p style='height:100vh;'></p>",Xe=t=>`
    background-color: white;
    color: black;
    padding: 25px;
    height: ${t}px;
    position: fixed;
    width: 100vw;
    bottom: 0;
`,et=(t,e)=>`
    <div id="${t}" style="${Xe(e)}"></div>
`,tt=({rawInfoText:t})=>{y(`showPriceInfo: ${t}`),(window.top||window).P.when("a-modal-framework","a-sheet").execute("show-price-info",function(r,n){var i;const o="a-modal-showPriceInfo",a={name:"showPriceInfoModal"},s=((i=n.get("webflow-bottomsheet-instance"))==null?void 0:i._height)||600,u=et(o,s),c={type:"inline",source:t+Qe};new r(u,c,a).present()})},me="/webflow-rx/",rt="http://localhost:8080",J={requestType:"cart.add-items.request/v1",resourcePath:"items/v1",responseType:"cart.add-items/v1",method:"POST",callbackId:"your-saves-immersive-view-experience/Mon Aug 07 2023 13:36:46 GMT-0700 (Pacific Daylight Time)/919866f55af84162a94a6928be5b040636954948bb80db9cc3fe96fbab901b2a"};class nt{async callbackToWebFlowServer(e){const r=this.constructUrl(e);return fetch(r,this.buildRequest(e)).then(n=>n).catch(n=>(B("Something went wrong with the fetch call: "+n.message,n),{}))}buildRequest(e){return{headers:this.buildHeaders(),method:e.method,body:JSON.stringify(e)}}buildHeaders(){const e={Accept:"application/vnd.com.amazon.xa+json"},r=document.querySelector('meta[name="flow-closure-id"]');if(r){const n=r.getAttribute("content");n&&(e["x-amzn-flow-closure-id"]=n)}return e}constructUrl(e){const r=new URLSearchParams(window.location.search);if(r.has("webflowrxMockResponse"))return new URL(`${rt}?mock-response=${r.get("webflowrxMockResponse")}`);const n=new URLSearchParams;r.forEach((c,l)=>{Q.some(i=>i.toLowerCase()===l.toLowerCase())&&n.set(l,c)});const o=e.flowRoute,a=this.getServerEndpoint().toString()+((o==null?void 0:o.flow.experienceId)??"");o!=null&&o.flow.inputs&&Object.entries(o.flow.inputs).forEach(([c,l])=>{if(l!=="placeholder"){const d=typeof l=="object"&&l!==null?JSON.stringify(l):String(l);n.set(c,d)}});const s=n.toString(),u=s?"?"+s+"&":"";return new URL(a+u)}getUrlParameters(e){let r="";return Q.forEach(n=>{const o=e.get(n);o!=null&&(r+=n+"="+o+"&")}),r!=""?"?"+r:r}getServerEndpoint(){if(location.hostname.includes("amazon")){const e=new URL(location.origin);return e.pathname=me,e}return new URL("https://pre-prod.amazon.com"+me)}}var $=(t=>(t[t.AmazonApi=0]="AmazonApi",t[t.Test=1]="Test",t))($||{}),te=(t=>(t[t.Override=0]="Override",t[t.Skip=1]="Skip",t[t.ReplaceEntirely=2]="ReplaceEntirely",t))(te||{});const be=class M{constructor(){if(M.instance)throw new Error("State manager is a singlaton class that should not be initialized more than once");this.clientSideStates=new Map,this.nodeStates=new Map}static getInstance(){return M.instance||(M.instance=new M),M.instance}postState(e,r,n,o){let a=this.clientSideStates.get(e);a||(a={}),a[r]=this.updatedState(a[r]??{},n,o),this.clientSideStates.set(e,a)}updatedState(e,r,n){if(n===0)return this.deepOverrideState(e,r);throw new Error("Unsupported collisionResolutionStrategy="+n)}updatedStateV2(e,r,n){if(n===0)return this.deepOverrideStateV2(e,r);throw new Error("Unsupported collisionResolutionStrategy="+n)}deepOverrideState(e,r){const n={...e};for(const o in r)typeof r[o]=="object"&&r[o]!==null&&typeof n[o]=="object"&&n[o]!==null?n[o]=this.deepOverrideState(n[o],r[o]):n[o]=r[o];return n}deepOverrideStateV2(e,r){const n={...e};for(const o in r)typeof r[o]=="object"&&r[o]!==null&&typeof n[o]=="object"&&n[o]!==null?Array.isArray(r[o])||Array.isArray(n[o])?n[o]=r[o]:n[o]=this.deepOverrideStateV2(n[o],r[o]):n[o]=r[o];return n}getState(e,r){const n=this.clientSideStates.get(e);if(n&&n[r]!==void 0)return n[r]}saveNodeState(e){this.nodeStates.set(e.id,e.state)}deleteNodeState(e){this.nodeStates.delete(e)}getNodeStates(){const e=[];return this.nodeStates.forEach((r,n)=>{e.push({id:n,state:r})}),e}getStateByVmmId(e,r,n){const o=`resource_${n}_vmmId_${r}`,a=this.clientSideStates.get(e);if(a&&a[o]!==void 0)return a[o]}postStateByVmmId(e,r,n,o,a){const s=`resource_${n}_vmmId_${r}`;let u=this.clientSideStates.get(e);u||(u={}),u[s]=this.updatedStateV2(u[s]??{},o,a),this.clientSideStates.set(e,u)}};be.instance=null;let z=be;class re{static saveInitialRenderingStateV1(e,r){this.saveAapiResourceReferencesV1(e.aapiResourceReferences,r)}static saveAapiResourceReferencesV1(e,r){try{JSON.parse(e).references.forEach(o=>{const a={resourcePath:o.resource,entity:o.entity};this.stateManager.postState($.AmazonApi,a.resourcePath,a,te.Override),r&&this.stateManager.postStateByVmmId($.AmazonApi,r,a.resourcePath,a,te.Override)})}catch(n){throw new Error(`Unable to parse and save aapi state to client side.
            Input=${e}.
            Error message=${n.message}`)}}static saveNodeState(e){this.stateManager.saveNodeState(e)}}re.stateManager=z.getInstance();const Fe=class W{constructor(){this.completedCount=0,this.completionSubject=new b.Subject,this.expectedCount=null,this.pollingInterval=null,this.startPolling()}static getInstance(){return W.instance||(W.instance=new W),W.instance}startPolling(){this.pollingInterval=setInterval(()=>{if(this.expectedCount===null){const e=document.querySelector("[data-webflow-rx-card-count]"),r=e==null?void 0:e.getAttribute("data-webflow-rx-card-count");r&&(this.expectedCount=parseInt(r,10),this.checkCompletion(),this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null))}},100),setTimeout(()=>{this.pollingInterval&&(C("WebFlowJS: Polling timeout - expected VMM count not found after 5 seconds"),clearInterval(this.pollingInterval),this.pollingInterval=null)},5e3)}markVMMComplete(){this.completedCount++,this.checkCompletion()}checkCompletion(){this.expectedCount!==null&&this.completedCount>=this.expectedCount&&this.completionSubject.next(!0)}resetRenderComplete(){this.completedCount=0,this.completionSubject=new b.Subject}getCompletionObservable(){return b.merge(b.of(!1),this.completionSubject.asObservable())}setExpectedCount(e){this.expectedCount=e}};Fe.instance=null;let H=Fe;const ot=()=>H.getInstance().getCompletionObservable();function at(t,e){Ue.onExternalConfig("webflow",r=>{Array.isArray(r)?st(r,e):it(r,t)})}function st(t,e){t.forEach(r=>{switch(y("external config data: ",r),r.type){case"view-model-mapper":{(async()=>{const n=H.getInstance();try{re.saveInitialRenderingStateV1(r.metadata,r.viewModelMapperUuid);const o=qe.createRxAdapterScope(),a=await Ne.executeViewModelMapper(r.viewModelMapperUuid,r.metadata),s=await o.externalComposed(r.externalComposedKey,a,{handleReentrantRender:async()=>{await e(r,s)}})}catch(o){C("WebFlow view model mapper execution failed. Event="+JSON.stringify(r),o)}finally{n.markVMMComplete()}})();break}case"node-state":{re.saveNodeState({id:r.id,state:r.state});break}case"example":{y("WebFlow example event");break}}})}function it(t,e){Ve.externalComposed(t.cardRuntimeInstanceId,{[t.publisherFunction]:r=>e(t.cardRuntimeBundleURI,r)}),y("external config data: ",t)}class G{constructor(e){this.type=e}}var F=(t=>(t.ViewPublisherResponse="ViewPublisherResponse",t.CardRerenderResponse="CardRerenderResponse",t.RemoteViewModelMapperExecutionResponse="RemoteViewModelMapperExecutionResponse",t.RemoteAAPIBatchOperationResponse="RemoteAAPIBatchOperationResponse",t.RemoteAAPIOperationResponse="RemoteAAPIOperationResponse",t.LayoutDiffingResponse="LayoutDiffingResponse",t.UnknownResponse="UnknownResponse",t))(F||{});class ut extends G{constructor(e){super(F.UnknownResponse),this.payload=e}}function v(t){y("Update Kata state to: "+t.kataState)}var S=(t=>(t.PENDING="PENDING",t.SUCCESS="SUCCESS",t.ERROR="ERROR",t))(S||{});function ct(t,e,r){return e=U(e),yt(t,ne()?Reflect.construct(e,r||[],U(t).constructor):e.apply(t,r))}function Se(t,e,r){if(ne())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&V(o,r.prototype),o}function ne(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ne=function(){return!!t})()}function lt(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function dt(t){var e=lt(t,"string");return typeof e=="symbol"?e:String(e)}function D(t){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(t)}function Re(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ve(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,dt(n.key),n)}}function De(t,e,r){return e&&ve(t.prototype,e),r&&ve(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function ft(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&V(t,e)}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},U(t)}function V(t,e){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},V(t,e)}function pt(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function oe(t){var e=typeof Map=="function"?new Map:void 0;return oe=function(n){if(n===null||!pt(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(n))return e.get(n);e.set(n,o)}function o(){return Se(n,arguments,U(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),V(o,n)},oe(t)}function ht(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yt(t,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ht(t)}function wt(t){return gt(t)||mt(t)||Ee(t)||bt()}function gt(t){if(Array.isArray(t))return ae(t)}function mt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ee(t,e){if(t){if(typeof t=="string")return ae(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ae(t,e)}}function ae(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function bt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ft(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Ee(t))||e&&t&&typeof t.length=="number"){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,u;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return a=c.done,c},e:function(c){s=!0,u=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(s)throw u}}}}var g=Object.prototype.hasOwnProperty;function x(t,e){return t=t.slice(),t.push(e),t}function se(t,e){return e=e.slice(),e.unshift(t),e}var St=function(t){ft(e,t);function e(r){var n;return Re(this,e),n=ct(this,e,['JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)']),n.avoidNew=!0,n.value=r,n.name="NewError",n}return De(e)}(oe(Error));function p(t,e,r,n,o){if(!(this instanceof p))try{return new p(t,e,r,n,o)}catch(c){if(!c.avoidNew)throw c;return c.value}typeof t=="string"&&(o=n,n=r,r=e,e=t,t=null);var a=t&&D(t)==="object";if(t=t||{},this.json=t.json||r,this.path=t.path||e,this.resultType=t.resultType||"value",this.flatten=t.flatten||!1,this.wrap=g.call(t,"wrap")?t.wrap:!0,this.sandbox=t.sandbox||{},this.preventEval=t.preventEval||!1,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||n||null,this.otherTypeCallback=t.otherTypeCallback||o||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},t.autostart!==!1){var s={path:a?t.path:e};a?"json"in t&&(s.json=t.json):s.json=r;var u=this.evaluate(s);if(!u||D(u)!=="object")throw new St(u);return u}}p.prototype.evaluate=function(t,e,r,n){var o=this,a=this.parent,s=this.parentProperty,u=this.flatten,c=this.wrap;if(this.currResultType=this.resultType,this.currPreventEval=this.preventEval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=n||this.otherTypeCallback,e=e||this.json,t=t||this.path,t&&D(t)==="object"&&!Array.isArray(t)){if(!t.path&&t.path!=="")throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!g.call(t,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');var l=t;e=l.json,u=g.call(t,"flatten")?t.flatten:u,this.currResultType=g.call(t,"resultType")?t.resultType:this.currResultType,this.currSandbox=g.call(t,"sandbox")?t.sandbox:this.currSandbox,c=g.call(t,"wrap")?t.wrap:c,this.currPreventEval=g.call(t,"preventEval")?t.preventEval:this.currPreventEval,r=g.call(t,"callback")?t.callback:r,this.currOtherTypeCallback=g.call(t,"otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,a=g.call(t,"parent")?t.parent:a,s=g.call(t,"parentProperty")?t.parentProperty:s,t=t.path}if(a=a||null,s=s||null,Array.isArray(t)&&(t=p.toPathString(t)),!(!t&&t!==""||!e)){var i=p.toPathArray(t);i[0]==="$"&&i.length>1&&i.shift(),this._hasParentSelector=null;var d=this._trace(i,e,["$"],a,s,r).filter(function(f){return f&&!f.isParentSelector});return d.length?!c&&d.length===1&&!d[0].hasArrExpr?this._getPreferredOutput(d[0]):d.reduce(function(f,w){var m=o._getPreferredOutput(w);return u&&Array.isArray(m)?f=f.concat(m):f.push(m),f},[]):c?[]:void 0}},p.prototype._getPreferredOutput=function(t){var e=this.currResultType;switch(e){case"all":{var r=Array.isArray(t.path)?t.path:p.toPathArray(t.path);return t.pointer=p.toPointer(r),t.path=typeof t.path=="string"?t.path:p.toPathString(t.path),t}case"value":case"parent":case"parentProperty":return t[e];case"path":return p.toPathString(t[e]);case"pointer":return p.toPointer(t.path);default:throw new TypeError("Unknown result type")}},p.prototype._handleCallback=function(t,e,r){if(e){var n=this._getPreferredOutput(t);t.path=typeof t.path=="string"?t.path:p.toPathString(t.path),e(n,r,t)}},p.prototype._trace=function(t,e,r,n,o,a,s,u){var c=this,l;if(!t.length)return l={path:r,value:e,parent:n,parentProperty:o,hasArrExpr:s},this._handleCallback(l,a,"value"),l;var i=t[0],d=t.slice(1),f=[];function w(h){Array.isArray(h)?h.forEach(function(we){f.push(we)}):f.push(h)}if((typeof i!="string"||u)&&e&&g.call(e,i))w(this._trace(d,e[i],x(r,i),e,i,a,s));else if(i==="*")this._walk(e,function(h){w(c._trace(d,e[h],x(r,h),e,h,a,!0,!0))});else if(i==="..")w(this._trace(d,e,r,n,o,a,s)),this._walk(e,function(h){D(e[h])==="object"&&w(c._trace(t.slice(),e[h],x(r,h),e,h,a,!0))});else{if(i==="^")return this._hasParentSelector=!0,{path:r.slice(0,-1),expr:d,isParentSelector:!0};if(i==="~")return l={path:x(r,i),value:o,parent:n,parentProperty:null},this._handleCallback(l,a,"property"),l;if(i==="$")w(this._trace(d,e,r,null,null,a,s));else if(/^(\x2D?[0-9]*):(\x2D?[0-9]*):?([0-9]*)$/.test(i))w(this._slice(i,d,e,r,n,o,a));else if(i.indexOf("?(")===0){if(this.currPreventEval)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");var m=i.replace(/^\?\(((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?)\)$/,"$1"),E=/@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])?((?:[\0->@-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)['\[](\??\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\))(?!(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\)\])['\]]/g.exec(m);E?this._walk(e,function(h){var we=[E[2]],er=E[1]?e[h][E[1]]:e[h],tr=c._trace(we,er,r,n,o,a,!0);tr.length>0&&w(c._trace(d,e[h],x(r,h),e,h,a,!0))}):this._walk(e,function(h){c._eval(m,e[h],h,r,n,o)&&w(c._trace(d,e[h],x(r,h),e,h,a,!0))})}else if(i[0]==="("){if(this.currPreventEval)throw new Error("Eval [(expr)] prevented in JSONPath expression.");w(this._trace(se(this._eval(i,e,r[r.length-1],r.slice(0,-1),n,o),d),e,r,n,o,a,s))}else if(i[0]==="@"){var R=!1,_=i.slice(1,-2);switch(_){case"scalar":(!e||!["object","function"].includes(D(e)))&&(R=!0);break;case"boolean":case"string":case"undefined":case"function":D(e)===_&&(R=!0);break;case"integer":Number.isFinite(e)&&!(e%1)&&(R=!0);break;case"number":Number.isFinite(e)&&(R=!0);break;case"nonFinite":typeof e=="number"&&!Number.isFinite(e)&&(R=!0);break;case"object":e&&D(e)===_&&(R=!0);break;case"array":Array.isArray(e)&&(R=!0);break;case"other":R=this.currOtherTypeCallback(e,r,n,o);break;case"null":e===null&&(R=!0);break;default:throw new TypeError("Unknown value type "+_)}if(R)return l={path:r,value:e,parent:n,parentProperty:o},this._handleCallback(l,a,"value"),l}else if(i[0]==="`"&&e&&g.call(e,i.slice(1))){var k=i.slice(1);w(this._trace(d,e[k],x(r,k),e,k,a,s,!0))}else if(i.includes(",")){var Zt=i.split(","),K=Ft(Zt),$e;try{for(K.s();!($e=K.n()).done;){var Qt=$e.value;w(this._trace(se(Qt,d),e,r,n,o,a,!0))}}catch(h){K.e(h)}finally{K.f()}}else!u&&e&&g.call(e,i)&&w(this._trace(d,e[i],x(r,i),e,i,a,s,!0))}if(this._hasParentSelector)for(var I=0;I<f.length;I++){var Y=f[I];if(Y&&Y.isParentSelector){var q=this._trace(Y.expr,e,Y.path,n,o,a,s);if(Array.isArray(q)){f[I]=q[0];for(var Xt=q.length,ye=1;ye<Xt;ye++)I++,f.splice(I,0,q[ye])}else f[I]=q}}return f},p.prototype._walk=function(t,e){if(Array.isArray(t))for(var r=t.length,n=0;n<r;n++)e(n);else t&&D(t)==="object"&&Object.keys(t).forEach(function(o){e(o)})},p.prototype._slice=function(t,e,r,n,o,a,s){if(Array.isArray(r)){var u=r.length,c=t.split(":"),l=c[2]&&Number.parseInt(c[2])||1,i=c[0]&&Number.parseInt(c[0])||0,d=c[1]&&Number.parseInt(c[1])||u;i=i<0?Math.max(0,i+u):Math.min(u,i),d=d<0?Math.max(0,d+u):Math.min(u,d);for(var f=[],w=i;w<d;w+=l){var m=this._trace(se(w,e),r,n,o,a,s,!0);m.forEach(function(E){f.push(E)})}return f}},p.prototype._eval=function(t,e,r,n,o,a){this.currSandbox._$_parentProperty=a,this.currSandbox._$_parent=o,this.currSandbox._$_property=r,this.currSandbox._$_root=this.json,this.currSandbox._$_v=e;var s=t.includes("@path");s&&(this.currSandbox._$_path=p.toPathString(n.concat([r])));var u="script:"+t;if(!p.cache[u]){var c=t.replace(/@parentProperty/g,"_$_parentProperty").replace(/@parent/g,"_$_parent").replace(/@property/g,"_$_property").replace(/@root/g,"_$_root").replace(/@([\t-\r \)\.\[\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])/g,"_$_v$1");s&&(c=c.replace(/@path/g,"_$_path")),p.cache[u]=new this.vm.Script(c)}try{return p.cache[u].runInNewContext(this.currSandbox)}catch(l){throw new Error("jsonPath: "+l.message+": "+t)}},p.cache={},p.toPathString=function(t){for(var e=t,r=e.length,n="$",o=1;o<r;o++)/^(~|\^|@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\(\))$/.test(e[o])||(n+=/^[\*0-9]+$/.test(e[o])?"["+e[o]+"]":"['"+e[o]+"']");return n},p.toPointer=function(t){for(var e=t,r=e.length,n="",o=1;o<r;o++)/^(~|\^|@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\(\))$/.test(e[o])||(n+="/"+e[o].toString().replace(/~/g,"~0").replace(/\//g,"~1"));return n},p.toPathArray=function(t){var e=p.cache;if(e[t])return e[t].concat();var r=[],n=t.replace(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/g,";$&;").replace(/['\[](\??\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\))['\]](?!(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\])/g,function(a,s){return"[#"+(r.push(s)-1)+"]"}).replace(/\[["']((?:[\0-&\(-\\\^-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)["']\]/g,function(a,s){return"['"+s.replace(/\./g,"%@%").replace(/~/g,"%%@@%%")+"']"}).replace(/~/g,";~;").replace(/["']?\.["']?(?!(?:[\0-Z\\-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*\])|\[["']?/g,";").replace(/%@%/g,".").replace(/%%@@%%/g,"~").replace(/(?:;)?(\^+)(?:;)?/g,function(a,s){return";"+s.split("").join(";")+";"}).replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),o=n.split(";").map(function(a){var s=a.match(/#([0-9]+)/);return!s||!s[1]?a:r[s[1]]});return e[t]=o,e[t].concat()};var Rt=function(e,r,n){for(var o=e.length,a=0;a<o;a++){var s=e[a];n(s)&&r.push(e.splice(a--,1)[0])}},vt=function(){function t(e){Re(this,t),this.code=e}return De(t,[{key:"runInNewContext",value:function(r){var n=this.code,o=Object.keys(r),a=[];Rt(o,a,function(i){return typeof r[i]=="function"});var s=o.map(function(i){return r[i]}),u=a.reduce(function(i,d){var f=r[d].toString();return/function/.test(f)||(f="function "+f),"var "+d+"="+f+";"+i},"");n=u+n,!/(["'])use strict\1/.test(n)&&!o.includes("arguments")&&(n="var arguments = undefined;"+n),n=n.replace(/;[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*$/,"");var c=n.lastIndexOf(";"),l=c>-1?n.slice(0,c+1)+" return "+n.slice(c+1):" return "+n;return Se(Function,o.concat([l])).apply(void 0,wt(s))}}]),t}();p.prototype.vm={Script:vt};const Dt={"[cart.count/v1].items":t=>{const e=window.top||window;e.P.when("nav.setCartCount").execute(function(r){r(t)}),e!==window&&window.P.when("nav.setCartCount").execute(function(r){r(t)})}};function ie(t){Object.entries(Dt).map(([e,r])=>{const n=p({path:"$.."+e,json:t});n.length==0?B("Could not find "+e+" in response",new Error("Invalid response. Search Result returned empty")):r(n[0])})}class ue extends G{constructor(e){super(F.RemoteAAPIBatchOperationResponse),this.payload=e}}class Et extends Error{constructor(e){super(F.UnknownResponse),this.payload=e,this.type=F.UnknownResponse}}class ce extends G{constructor(e){super(F.LayoutDiffingResponse),this.payload=e}}class xe extends G{constructor(e){super(F.CardRerenderResponse),this.payload=e}}function xt(t){const e=t.match(/boundary=([^;]+)/);if(!e)throw new Error("No boundary found in Content-Type header");let r=e[1].trim();return r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1)),r}function Oe(t){const e={},r=t.trim().split(`
`);for(const n of r){const o=n.indexOf(":");if(o>0){const a=n.substring(0,o).trim(),s=n.substring(o+1).trim();e[a]=s}}return e}function Ot(t){const e=t.trim();if(!e)return null;const r=[`
\r
`,`\r
\r
`,`

`];for(const n of r){const o=e.indexOf(n);if(o!==-1){const a=e.substring(0,o),s=e.substring(o+n.length);return{headers:Oe(a),body:s}}}return{headers:Oe(e),body:""}}async function Pt(t,e){var c;const r=t.headers.get("content-type");if(!r)throw new Error("Missing Content-Type header");const o=`--${xt(r)}`,a=(c=t.body)==null?void 0:c.getReader();if(!a)throw new Error("Response body is not readable");const s=new TextDecoder;let u="";try{for(;;){const{done:l,value:i}=await a.read();if(i){const f=s.decode(i,{stream:!0});u+=f}let d=u.indexOf(o);for(;d!==-1;){const f=d+o.length,w=u.indexOf(o,f);if(w===-1)break;let m=d+o.length;u[m]===`
`&&m++,u[m]==="\r"&&m++;const E=u.substring(m,w);u=u.substring(w),d=0;const _=u.substring(o.length,o.length+2)==="--";if(E.trim()){const k=Ot(E);k&&await e(k)}if(_)return}if(l)break}}finally{a.releaseLock()}}const Pe=Z.setExternalPatchReplaceTransitionState??(()=>{ee("setExternalPatchReplaceTransitionState not yet implemented")}),Ct=Z.clearExternalPatchReplaceTransitionState??(()=>{ee("clearExternalPatchReplaceTransitionState not yet implemented")});class A{constructor(){}static getInstance(){return A.instance||(A.instance=new A),A.instance}setCurrentRequest(e,r){this.currentFlowRoute=e,this.presentationConfig=r}getFlowRoute(){return this.currentFlowRoute}getPresentationConfig(){return this.presentationConfig}applyGrayout(){this.presentationConfig&&Pe({allowedIds:this.presentationConfig.animationIdPrefixAllowList,disallowedIds:this.presentationConfig.animationIdPrefixDisallowList})}applyGrayoutToTarget(e){this.presentationConfig&&Pe({allowedIds:this.presentationConfig.animationIdPrefixAllowList,disallowedIds:this.presentationConfig.animationIdPrefixDisallowList,targetElement:e})}clearGrayout(){Ct()}clear(){this.currentFlowRoute=void 0,this.presentationConfig=void 0}}const At=Z.patchReplaceOnExternalConfig??(()=>{ee("patchReplaceOnExternalConfig not yet implemented")});class It{setWebFlowClient(e){this.webflowClient=e}updateBrowserUrl(e){if(!(e!=null&&e.flow.inputs))return;const r=new URL(window.location.href);let n=!1,o=!1;if(e.flow.inputs.asin&&e.flow.inputs.asin!=="placeholder"){const l=String(e.flow.inputs.asin);if(r.pathname.includes("/product/")){if(/\/product\/[A-Z0-9]{10}/.test(r.pathname)){const d=r.pathname;r.pathname=r.pathname.replace(/\/product\/[A-Z0-9]{10}/,`/product/${l}`),d!==r.pathname&&(n=!0,o=!0)}}else if(r.pathname.includes("/dp/")&&/\/dp\/[A-Z0-9]{10}\//.test(r.pathname)){const d=r.pathname;r.pathname=r.pathname.replace(/\/dp\/[A-Z0-9]{10}\//,`/dp/${l}/`),d!==r.pathname&&(n=!0,o=!0)}}const a=new URLSearchParams,s=new URLSearchParams(r.search);s.forEach((l,i)=>{Q.some(d=>d.toLowerCase()===i.toLowerCase())&&a.set(i,l)}),Object.entries(e.flow.inputs).forEach(([l,i])=>{if(i!=="placeholder"){const f=typeof i=="object"&&i!==null?JSON.stringify(i):String(i);if(l==="asin"){if(o){s.has("asin")&&a.set(l,f);return}a.set(l,f);return}a.set(l,f)}});const u=a.toString(),c=r.searchParams.toString();u!==c&&(r.search=u,n=!0),n&&window.history.replaceState(null,"",r.href)}async handleRxResponse(e){if(e.ok)return this.convertToRxResponse(e);{const r=new Error("Response is not ok");throw B("Fetch call returned "+e.status+": "+r.message,r),new Et(this.handleUnknownResponse(e))}}async convertToRxResponse(e){var r;try{if((r=e.headers.get("content-type"))!=null&&r.includes("multipart/mixed")){const n=e.headers.get("content-type"),o=n==null?void 0:n.match(/type=([^;]+)/),a=o?o[1]:null;return a==="card-rerender"?this.handleCardRerenderResponse(e):a==="layout-diffing"?this.handleLayoutDiffingResponse(e):this.handleLayoutDiffingResponse(e)}else{const n=await e.text(),o=JSON.parse(n);switch(o.type){case F.ViewPublisherResponse:return this.handleViewPublisherResponse(o);case F.RemoteViewModelMapperExecutionResponse:return this.handleRemoteViewModelMapperResponse(o);case F.RemoteAAPIBatchOperationResponse:return this.handleRemoteBatchAAPIOperationsRxResponse(this.parseBatchAAPIOperationRxResponse(o));case F.UnknownResponse:default:return this.handleUnknownResponse(e)}}}catch(n){return B("Something went wrong in WebFlowServerRxResponseHandler: "+n.message,n),this.handleUnknownResponse(e)}}parseBatchAAPIOperationRxResponse(e){return new ue(e.payload)}handleViewPublisherResponse(e){return e.payload.statusCode==200?(ie(e.payload.untypedResponseBody),v({kataState:S.SUCCESS})):v({kataState:S.ERROR}),e}handleRemoteViewModelMapperResponse(e){return e.payload.statusCode==200&&ie(e.payload.untypedResponseBody),e}handleRemoteBatchAAPIOperationsRxResponse(e){for(const r of e.payload.aapiOperationResponses)r.payload.statusCode===200&&(r.payload.type==="product/v2"?(y("WebFlowJS: AAPI product/v2 response received:",e),v({kataState:S.SUCCESS})):ie(r.payload.untypedResponseBody));return e}async handleCardRerenderResponse(e){const r=e.status;return r!==200?(v({kataState:S.ERROR}),new xe({status:"error",message:`Card rerender returned non-200 status code: ${r}`,statusCode:r})):(y("WebFlowJS: Card rerender response received and processed successfully"),v({kataState:S.SUCCESS}),new xe({status:"success",message:"Card rerender completed successfully",statusCode:200}))}async handleLayoutDiffingResponse(e){const r=e.status;if(r!==200)return v({kataState:S.ERROR}),new ce({status:"error",message:`Server returned non-200 status code: ${r}`,statusCode:r});const n=A.getInstance();try{await Pt(e,a=>{if(a.headers.Type==="diffing.node.diff/v1"){const s=document.createElement("div");return s.innerHTML=a.body,n.applyGrayoutToTarget(s),At(a.headers.referenceId,s.innerHTML)}a.headers.Type==="diffing.node.delete/v1"&&z.getInstance().deleteNodeState(a.headers.referenceId),a.headers.Type==="rxCount/v1"&&H.getInstance().setExpectedCount(parseInt(a.body))});const o=n.getFlowRoute();return o&&this.updateBrowserUrl(o),v({kataState:S.SUCCESS}),new ce({status:"success",message:"Layout diffing completed successfully",statusCode:r})}catch(o){const a=o instanceof Error?o.message:String(o);return B("WebFlowJS: Failed to process layout diffing:"+o.message,o),v({kataState:S.ERROR}),new ce({status:"error",message:`Failed to process layout diffing: ${a}`,statusCode:r})}}handleUnknownResponse(e){return v({kataState:S.ERROR}),new ut(e)}}class Tt{buildRemoteViewModelMapperRequestV1(e,r){return{method:"POST",requestType:"RemoteViewModelMapperExecution",schemaVersion:"V1",bundleUri:e.bundleUri,payload:{viewModelMapperLocator:e,variableTable:r.serialize()}}}buildRemoteBatchAAPIOperation(e){return{method:"POST",requestType:"RemoteBatchAAPIOperation",schemaVersion:"2",payload:e}}buildBlueprintDiffRequest(e,r){return{method:"POST",requestType:"LayoutDiffingRequest",schemaVersion:"1",payload:{previousRenderStates:e},flowRoute:r}}handleRequest(e,r){return v({kataState:S.PENDING}),y("payload: ",r),this.buildRxRequestBody(e,r)}buildRxRequestBody(e,r){return{resourcePath:J.resourcePath,responseType:J.responseType,method:J.method,bundleUri:e,payload:r}}buildReentrantRenderRequest(e,r){const{externalComposedKey:n,viewModelMapperUuid:o,metadata:{bundleUri:a="",initialViewModel:s={},inputModel:u={},aapiResourceReferences:c={}}={}}=e;let l=c;if(typeof c=="string")try{l=JSON.parse(c)}catch{console.warn("Failed to parse aapiResourceReferences JSON:",c),l={}}const i=n.split("/"),d=i.length>5?i[5]:null;return{method:"POST",requestType:"CardRerender",schemaVersion:"1",bundleUri:a,flowRoute:{flow:{experienceId:d,inputs:{}}},payload:{rerenderInstructions:[{referenceId:n,bundleUri:a,viewModelMapperUuid:o,initialViewModel:s,inputModel:u,aapiResourceReferences:l,reentrantVars:r}]}}}}const _t={bodyEnd:"be",bodyBegin:"bb"},kt="ld",Ce={wb:1},Mt=t=>{y(`Start timer for latency metric: ${t}`),window.uet&&window.uet(_t.bodyBegin,t,Ce)},Ae=t=>{y(`End timer: ${t}`),window.uex&&window.uex(kt,t,Ce)},Ie=class L{constructor(){this.webflowClient=new nt,this.rxRequestHandler=new Tt,this.webflowServerRxResponseHandler=new It}static getInstance(){return L.instance||(L.instance=new L),L.instance}async executeRxRequest(e){const r=performance.now();try{const n=await this.webflowClient.callbackToWebFlowServer(e);return await this.webflowServerRxResponseHandler.handleRxResponse(n)}catch(n){return C("Failed to execute RxRequest - "+e,n),n.payload}finally{const o=performance.now()-r;y(`WebFlow RxRequestTime: ${o.toFixed(2)}ms`)}}async renderExperience(e,r){const n=this.rxRequestHandler.handleRequest(e,r);return this.executeRxRequest(n)}async executeRemoteViewModelMapper(e,r){const n=this.rxRequestHandler.buildRemoteViewModelMapperRequestV1(e,r);return this.executeRxRequest(n)}async executeRemoteBatchAAPIOperation(e){const r=this.rxRequestHandler.buildRemoteBatchAAPIOperation(e);return this.executeRxRequest(r)}async executeBlueprintDiffing(e,r){const n=e.flow.experienceId,o=n?`webflow-layout-diffing-${n}`:"webflow-layout-diffing",a=A.getInstance();a.setCurrentRequest(e,r),Mt(o);try{a.applyGrayout(),H.getInstance().resetRenderComplete();const s=z.getInstance().getNodeStates(),u=this.rxRequestHandler.buildBlueprintDiffRequest(s,e);y("WebFlowJS: Executing blueprint diffing request:",u);const c=await this.executeRxRequest(u);return Ae(o),c}catch(s){throw Ae(o),s}finally{a.clearGrayout(),a.clear()}}getExperienceState(){return{callbackId:J.callbackId}}async executeReentrantRender(e,r){try{const{externalComposedKey:n,viewModelMapperUuid:o,metadata:{bundleUri:a="",initialViewModel:s={},inputModel:u={},aapiResourceReferences:c={},...l}={}}=e;if(y("WebFlowJS: Extracted event data:",{externalComposedKey:n,viewModelMapperUuid:o,bundleUri:a,initialViewModel:s,inputModel:u,aapiResourceReferences:c,otherMetadata:l}),!r)throw new Error(`No composed callbacks provided for externalComposedKey: ${n}`);if(!r.captureVars||typeof r.captureVars!="function")throw new Error(`captureVars method not available for externalComposedKey: ${n}`);const i=await r.captureVars();y("WebFlowJS: Captured reentrant vars for",n,":",i);const d=this.rxRequestHandler.buildReentrantRenderRequest(e,i);y("WebFlowJS: Executing enhanced reentrant rendering request:",d);const f=await this.executeRxRequest(d);y("WebFlowJS: Reentrant Render response:",f)}catch(n){throw C("WebFlowJS: Reentrant rendering failed for "+((e==null?void 0:e.externalComposedKey)||"unknown"),n),n}}register(){at(this.renderExperience.bind(this),this.executeReentrantRender.bind(this))}};Ie.instance=null;let N=Ie;var T=(t=>(t.WebFlowServerError="Internal WebFlow Server Error",t.ExperienceModelError="Unexpected Input received from the experience model",t))(T||{});class le{static async post(e,...r){const n=[e,...r].map(a=>({...a,resourcePath:this.resolveResourcePath(a.resourcePath,a.params,a.requestArguments),method:"POST"})),o=await N.getInstance().executeRemoteBatchAAPIOperation({payload:n});return o instanceof ue?this.unpackPostResponse(o,n[0]):this.ofFailedOperation(n[0],"Received unexpected response type from the server.",T.WebFlowServerError)}static unpackPostResponse(e,r){if(e.payload.statusCode==500)return this.ofFailedOperation(r,"The BatchAAPIOperationRequest failed.",T.WebFlowServerError);const n=e.payload.aapiOperationResponses[0];return n?n.payload.statusCode==500?this.ofFailedOperation(r,n.payload.untypedError,n.payload.type):this.proxyResultWithOverloadedGetOperator({isSuccess:!0,resource:n.payload.untypedResponseBody,type:n.payload.type}):this.ofFailedOperation(r,`No AAPI response was returned for this operation: ${JSON.stringify(r)}`,T.WebFlowServerError)}static get(e,r){if(e.payload)return this.ofFailedOperation(e,"GET AAPIOperation does not accept a payload.",T.ExperienceModelError);const n=this.resolveResourcePath(e.resourcePath,e.params,e.requestArguments);if(r){const s=this.stateManager.getStateByVmmId($.AmazonApi,r,n);if(s&&!this.isResourceError(s==null?void 0:s.entity)){const u=s==null?void 0:s.entity[e.responseType];if(u)return this.proxyResultWithOverloadedGetOperator({isSuccess:!0,resource:u,type:e.responseType})}}const o=this.stateManager.getState($.AmazonApi,n);if(this.isResourceError(o==null?void 0:o.entity))return this.remoteGetRequest(e);const a=o==null?void 0:o.entity[e.responseType];return a?this.proxyResultWithOverloadedGetOperator({isSuccess:!0,resource:a,type:e.responseType}):this.remoteGetRequest(e)}static async remoteGetRequest(e){const r=await N.getInstance().executeRemoteBatchAAPIOperation({payload:[e]});return r instanceof ue?this.unpackPostResponse(r,e):this.ofFailedOperation(e,"Received unexpected response type from the server.",T.WebFlowServerError)}static ofFailedOperation(e,r,n){const o=new Error(`AAPI resource operation failed. Operation=${JSON.stringify(e)}. Detailed Message=${r}`);return this.proxyResultWithOverloadedGetOperator({isSuccess:!1,error:o,type:n})}static isResourceError(e){return e&&"errorPayload"in e}static resolveResourcePath(e,r,n){if(r&&Object.keys(r).forEach(o=>{e=e.replace(`${o}`,r[o])}),e.includes("?")&&!n){const[o,a]=e.split("?");if(a){const u=a.split("&").sort().join("&");e=`${o}?${u}`}}return n&&(e+="?",Object.keys(n).sort().forEach(a=>{e+=`${a}=${n[a]}&`}),e=e.substring(0,e.length-1)),e}static proxyResultWithOverloadedGetOperator(e){const r={get(n,o){return n.resource&&n.resource[o]!==void 0?n.resource[o]:Reflect.get(n,o)}};return new Proxy(e,r)}}le.stateManager=z.getInstance();function Bt(){let t=window.location.href;return t||(C("ingressUrl not presented"),t=""),{ingressUrl:t}}const jt=Bt(),$t=()=>jt;function Ut(){const t=$t().ingressUrl;if(!t)return"";try{return new URL(t).search??""}catch{return""}}const Te=({request:t,queryString:e})=>{y(`addToCart: request = ${t} - queryString = ${e}`);const n={resourcePath:`/api/marketplaces/:marketplace-id/cart/carts/retail/items${e?`?${e}`:Ut()}`,requestType:"cart.add-items.request/v1",responseType:"cart.add-items/v1",payload:t,method:"POST"};return b.from(le.post(n))},Vt=new Set(["null","boolean","int","long","float","double","bytes","string","record","enum","array","map","fixed"]),_e="csa.ContentInteraction.2",ke="dawnSearch.DawnContentInteractions.4",Nt=t=>{const e={...Be(t.data),lob:"1"};return Me(t.producerId,{schemaId:t.schemaId,...e,customerId:qt()},{ent:{page:["pageType","subPageType","requestId"],element:!0}}),t.schemaId===ke&&(y(`[logClientSideAnalyticsEvent] Dual-publishing ${ke} event to ${_e}`),Me(t.producerId,{schemaId:_e,...e},{ent:{page:["pageType","subPageType"],element:!0}})),b.EMPTY};function qt(){var t,e,r,n,o;return((t=window.opts)==null?void 0:t.customerId)??((o=(n=(r=(e=window.$Nav)==null?void 0:e.getNow)==null?void 0:r.call(e,"config"))==null?void 0:n.searchISS)==null?void 0:o.customerId)??""}function Me(t,e,r){var o;const n=(o=window==null?void 0:window.csa)==null?void 0:o.call(window,"Events",{producerId:t});if(!n){y("[logClientSideAnalyticsEvent] CSA API not available, unable to log event.");return}y(`[logClientSideAnalyticsEvent] Logging event to CSA:
event = ${JSON.stringify(e,null,4)}
option = ${JSON.stringify(r,null,4)}`),n("log",e,r)}function Be(t){const e={};for(const[r,n]of Object.entries(t))e[r]=de(n);return e}function de(t){if(t==null)return t;if(Array.isArray(t))return t.map(de);if(typeof t=="object"){const e=Object.keys(t);return e.length===1&&Vt.has(e[0])?de(t[e[0]]):Be(t)}return t}const Wt=({objectToStringify:t})=>{try{return JSON.stringify(t)}catch(e){throw new Error(`Serialization failed: ${e}`)}},Lt=({stringToLog:t})=>{y("[FlowLog]: "+t)},fe=new Map,je=new Set;function Jt(t,e){fe.has(e)||fe.set(e,new Map);const r=fe.get(e);if(!r.has(t)){const n=new b.Subject,o=n.next.bind(n);n.next=l=>{o(l);try{P.when("A").execute(i=>{i&&i.trigger&&i.trigger("flowReactiveViewSubject:"+t,l)})}catch(i){C("Failed to execute P.now(A).execute() for subject: "+t,i)}};const a=n.asObservable();a.asReactiveViewValue=()=>b.ofReactiveViewValue(n.asObservable());const s=`flowReactiveViewSubject:${t}`;if(!je.has(s))try{P.when("A").execute(l=>{l&&l.on&&(l.on(s,i=>{o(i)}),je.add(s),l.trigger&&l.trigger(`flow-icc-ready:${t}`,t))})}catch(l){C("Failed to set up AUI event listener for subject: "+t,l)}const u=b.ofReactiveViewPublisher(n),c={value:a,publisher:u};r.set(t,c)}return r.get(t)}const zt=({id:t,webFlowRequestId:e})=>Jt(t,e),Ht=({route:t,presentationConfig:e})=>{N.getInstance().executeBlueprintDiffing(t,e)};class Gt{constructor(){this.invokeFunction=(e,r)=>e in this.functions?this.functions[e](r):(console.warn(`No implementation defined for ${e}! Skipping execution.`),b.EMPTY),this.functions={showUpdatableToast:Ze,showPriceInfo:tt,addToCart:Te,addToCartTemp:Te,logClientSideAnalyticsEvent:Nt,stringify:Wt,log:Lt,bindReactiveViewSubject:zt,flowExperienceRenderComplete:ot,show:Ht}}registerFunction(e,r){this.functions[e]=r}}const pe=new Gt;function Kt(t,e){return b.from(N.getInstance().executeRemoteViewModelMapper(t,e))}const he=N.getInstance();he.register();const Yt=he.executeBlueprintDiffing.bind(he);O.AAPIResourceManager=le,O.executeBlueprintDiffing=Yt,O.executePortableFunction=ze,O.executeRemoteViewModelMapper=Kt,O.functionRegistry=pe,O.registerPortableFunction=Je,Object.defineProperty(O,Symbol.toStringTag,{value:"Module"})});
