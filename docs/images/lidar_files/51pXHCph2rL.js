(function(w){var x=window.AmazonUIPageJS||window.P,q=x._namespace||x.attributeErrors,n=q?q("AmazonLightsaberPageAssets",""):x;n.guardFatal?n.guardFatal(w)(n,window):n.execute(function(){w(n,window)})})(function(w,x,q){(function(){var n;(function(d){d.isSupportedAndroidMshopClient=function(a){return a.capabilities.isAmazonApp&&a.capabilities.android};d.isSupportedMobileWebBrowserClient=function(b){return!!b.capabilities&&b.capabilities.android&&b.capabilities.mobile&&!b.capabilities.isAmazonApp&&a()};
d.isSupportedDesktopClient=function(b){return d.isDesktopDevice(b)&&a()};var b=function(a){try{return a.test(navigator.userAgent)}catch(c){return!1}},a=function(){var a=String.fromCharCode(92);return b(/Chrome/i)&&!b(/Edg/i)&&!b(/OPR/i)&&!b(new RegExp(a+"bwv"+a+"b"))};d.isDesktopDevice=function(a){return!!a.capabilities&&!a.capabilities.mobile&&!a.capabilities.tablet};d.isTabletDevice=function(a){return!!a.capabilities&&a.capabilities.tablet}})(n||(n={}));var E;(function(d){d.deep=function(b){return JSON.parse(JSON.stringify(b))}})(E||
(E={}));var y;(function(d){d.log=function(b){for(var a=1;a<arguments.length;a++);}})(y||(y={}));var N=this&&this.__awaiter||function(d,b,a,f){function c(b){return b instanceof a?b:new a(function(a){a(b)})}return new (a||(a=Promise))(function(a,g){function e(a){try{l(f.next(a))}catch(m){g(m)}}function h(a){try{l(f["throw"](a))}catch(m){g(m)}}function l(b){b.done?a(b.value):c(b.value).then(e,h)}l((f=f.apply(d,b||[])).next())})},O=this&&this.__generator||function(d,b){function a(a){return function(b){return f([a,
b])}}function f(a){if(h)throw new TypeError("Generator is already executing.");for(;c;)try{if(h=1,g&&(e=a[0]&2?g["return"]:a[0]?g["throw"]||((e=g["return"])&&e.call(g),0):g.next)&&!(e=e.call(g,a[1])).done)return e;if(g=0,e)a=[a[0]&2,e.value];switch(a[0]){case 0:case 1:e=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++;g=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(e=c.trys,e=0<e.length&&e[e.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&
(!e||a[1]>e[0]&&a[1]<e[3]))c.label=a[1];else if(6===a[0]&&c.label<e[1])c.label=e[1],e=a;else if(e&&c.label<e[2])c.label=e[2],c.ops.push(a);else{e[2]&&c.ops.pop();c.trys.pop();continue}}a=b.call(d,c)}catch(r){a=[6,r],g=0}finally{h=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var c={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,e,k;return k={next:a(0),"throw":a(1),"return":a(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),
k},B;(function(d){var b=this;d.getMatchingEntry=function(a){return N(b,void 0,void 0,function(){return O(this,function(b){return[2,new Promise(function(b,f){if("PerformanceObserver"in self&&-1<PerformanceObserver.supportedEntryTypes.indexOf("largest-contentful-paint")){var c=new PerformanceObserver(function(c,f){c=c.getEntries();for(var e=0;e<c.length;e++){var d=c[e];if(a(d)){f.disconnect();b(d);break}}});try{c.observe({type:"largest-contentful-paint",buffered:!0})}catch(e){try{c.disconnect()}catch(k){}f(e)}}else f(Error("LCPUnsupported"))})]})})}})(B||
(B={}));var C;(function(d){var b=/^https:\/\/([\w\.-]+)\/(images(?:\/W\/[^\/]+\/images)?\/I\/)([\w\+\-]+)?(\..*)?$/i;d.parseImageURL=function(a){if(a=a.match(b))return{hostname:a[1],prefix:a[2],physicalId:a[3],suffix:a[4]}}})(C||(C={}));var z;(function(d){var b="function"===typeof String.prototype.endsWith;d.capitalizeFirstChar=function(a){return a&&"string"===typeof a&&0!==a.length?a.charAt(0).toUpperCase()+a.slice(1):""};d.endsWith=function(a,f){return null==a?!1:b?a.endsWith(f):a.length>=f.length&&
a.substring(a.length-f.length)===f}})(z||(z={}));var L=this&&this.__awaiter||function(d,b,a,f){function c(b){return b instanceof a?b:new a(function(a){a(b)})}return new (a||(a=Promise))(function(a,g){function e(a){try{l(f.next(a))}catch(m){g(m)}}function h(a){try{l(f["throw"](a))}catch(m){g(m)}}function l(b){b.done?a(b.value):c(b.value).then(e,h)}l((f=f.apply(d,b||[])).next())})},M=this&&this.__generator||function(d,b){function a(a){return function(b){return f([a,b])}}function f(a){if(h)throw new TypeError("Generator is already executing.");
for(;c;)try{if(h=1,g&&(e=a[0]&2?g["return"]:a[0]?g["throw"]||((e=g["return"])&&e.call(g),0):g.next)&&!(e=e.call(g,a[1])).done)return e;if(g=0,e)a=[a[0]&2,e.value];switch(a[0]){case 0:case 1:e=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++;g=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(e=c.trys,e=0<e.length&&e[e.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!e||a[1]>e[0]&&a[1]<e[3]))c.label=a[1];else if(6===a[0]&&c.label<e[1])c.label=
e[1],e=a;else if(e&&c.label<e[2])c.label=e[2],c.ops.push(a);else{e[2]&&c.ops.pop();c.trys.pop();continue}}a=b.call(d,c)}catch(r){a=[6,r],g=0}finally{h=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var c={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,e,k;return k={next:a(0),"throw":a(1),"return":a(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k},p;(function(d){var b=this;d.queueTask=function(a,b){return setTimeout(a,b||
0)};d.queueTaskEvery=function(a,b){return setInterval(a,b)};d.clearQueuedTask=function(a){clearTimeout(a)};d.wait=function(a){return L(b,void 0,void 0,function(){return M(this,function(b){return[2,new Promise(function(b){setTimeout(b,a)})]})})};d.queueMicrotask=function(a){Promise.resolve().then(function(){a()})};d.waitTillIdleOrTimeout=function(a){return L(b,void 0,void 0,function(){return M(this,function(b){return[2,new Promise(function(b){self.requestIdleCallback?self.requestIdleCallback(function(a){b(a)},
{timeout:a}):setTimeout(function(){b({didTimeout:!0,timeRemaining:function(){return 0}})},a)})]})})}})(p||(p={}));var u;(function(d){d.isObject=function(b){return!!b&&"object"===typeof b&&!Array.isArray(b)};d.isNonEmptyString=function(b){return"string"===typeof b&&0<b.length};d.isPositiveInteger=function(b){return"number"===typeof b&&Math.floor(b)===b&&0<=b&&Infinity!==b};d.isFunction=function(b){return"function"===typeof b}})(u||(u={}));var P=function(){function d(b){this._global=b;var a=u.isFunction;
this._unsupported=!b.ue||!a(b.ue.tag)||!a(b.ue.count)||!a(b.uet)||!a(b.uex)||!a(b.ueLogError)}d.prototype.tag=function(b){this._unsupported||(b=this._getMetricName(b),this._global.ue.tag(b),this._global.ue.isl&&this._global.uex("at"),y.log("Lightsaber:Tag:",b))};d.prototype.count=function(b,a){void 0===a&&(a=1);this._unsupported||(b=this._getMetricName(b),this._global.ue.count(b,a),y.log("Lightsaber:Counter:",b,a))};d.prototype.widgetLatency=function(b,a,f){a=this._getMetricName(a);"ld"===b?this._global.uex(b,
a,{wb:1},f):this._global.uet(b,a,{wb:1},f)};d.prototype.logError=function(b,a){};d.prototype._getMetricName=function(b){return(d._METRIC_PREFIX+":"+b).toLowerCase()};d._METRIC_PREFIX="Lightsaber:Page";d._DEFAULT_JS_ERROR_ATTRIBUTION="AmazonLightsaberPageAssets";d._DEFAULT_JS_ERROR_LOG_LEVEL="ERROR";return d}(),Q={"gateway-phone-apps":"HomePage","gateway-phone-web":"HomePage",Gateway:"HomePage",SearchAW:"Search",Search:"Search",DetailWebView:"Detail",WebflowDetailWebView:"Detail",DetailAW:"Detail",
WebflowDetailAW:"Detail",Detail:"Detail",WebflowDetail:"Detail",ShoppingCartWebview:"Cart",ShoppingCartAW:"Cart",ShoppingCart:"Cart",CheckoutConfirmOrderWebview:"Checkout",CheckoutConfirmOrderAW:"Checkout",CheckoutConfirmOrder:"Checkout"},t;(function(d){d.getPageType=function(b){return b.ue_pty||"unknown"};d.getSubPageType=function(b){return b.ue_spty||"unknown"};d.getRequestId=function(b){return b.ue_id};d.getPageTypeGroup=function(b){b=d.getPageType(b);return(b=Q[b])?b:"Unknown"}})(t||(t={}));var A=
function(){function d(b,a,f){this.global=b;this._csmLogger=f;this._workerMessaging=a}d.prototype.getAbsoluteUrl=function(b){return(new URL(b,this.global.location.href)).href};d.prototype.ready=function(){return this._workerMessaging.ready()};d.prototype.sendToWorker=function(b){this._workerMessaging.send(d._RENDERING_HINTS_COMMAND,b)};d.prototype.logCount=function(b,a){this._csmLogger.count("RenderingHints:Collect:"+b,a)};d.prototype.logError=function(b,a){this._csmLogger.logError(b,a)};d._RENDERING_HINTS_COMMAND=
"rendering_hints";return d}(),R=this&&this.__extends||function(){var d=function(b,a){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return d(b,a)};return function(b,a){function f(){this.constructor=b}d(b,a);b.prototype=null===a?Object.create(a):(f.prototype=a.prototype,new f)}}(),S=this&&this.__awaiter||function(d,b,a,f){function c(b){return b instanceof a?b:new a(function(a){a(b)})}return new (a||
(a=Promise))(function(a,g){function e(a){try{l(f.next(a))}catch(m){g(m)}}function h(a){try{l(f["throw"](a))}catch(m){g(m)}}function l(b){b.done?a(b.value):c(b.value).then(e,h)}l((f=f.apply(d,b||[])).next())})},T=this&&this.__generator||function(d,b){function a(a){return function(b){return f([a,b])}}function f(a){if(h)throw new TypeError("Generator is already executing.");for(;c;)try{if(h=1,g&&(e=a[0]&2?g["return"]:a[0]?g["throw"]||((e=g["return"])&&e.call(g),0):g.next)&&!(e=e.call(g,a[1])).done)return e;
if(g=0,e)a=[a[0]&2,e.value];switch(a[0]){case 0:case 1:e=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++;g=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(e=c.trys,e=0<e.length&&e[e.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!e||a[1]>e[0]&&a[1]<e[3]))c.label=a[1];else if(6===a[0]&&c.label<e[1])c.label=e[1],e=a;else if(e&&c.label<e[2])c.label=e[2],c.ops.push(a);else{e[2]&&c.ops.pop();c.trys.pop();continue}}a=b.call(d,c)}catch(r){a=
[6,r],g=0}finally{h=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var c={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,e,k;return k={next:a(0),"throw":a(1),"return":a(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k},D=function(d){function b(a,b,c,h){b=d.call(this,a,b,c)||this;b._queryRoot=h||a.document;return b}R(b,d);b.prototype.trigger=function(){var a=this;p.queueTask(function(){return S(a,void 0,void 0,function(){var a;
return T(this,function(c){switch(c.label){case 0:return[4,p.waitTillIdleOrTimeout(b._IDLE_TIMEOUT)];case 1:c.sent();if(!this.ready())return this.logCount("NotReady"),[2];a=this.collect(this._queryRoot);this._send(a);return[2]}})})})};b.prototype._send=function(a){var f=this,c=Object.keys(a).map(function(c){return{nature:b._RENDERING_HINTS_NATURE,target:c,data:a[c],source:f._getSource()}});this.logCount("Targets",c.length);1>c.length||this.sendToWorker(c)};b.prototype._getSource=function(){return{url:this.global.location.href,
pty:t.getPageType(this.global),spty:t.getSubPageType(this.global),rid:t.getRequestId(this.global)}};b._IDLE_TIMEOUT=1E3;b._RENDERING_HINTS_NATURE="speculated_navigation_content";return b}(A),U=this&&this.__extends||function(){var d=function(b,a){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return d(b,a)};return function(b,a){function f(){this.constructor=b}d(b,a);b.prototype=null===a?Object.create(a):
(f.prototype=a.prototype,new f)}}(),F=this&&this.__assign||function(){F=Object.assign||function(d){for(var b,a=1,f=arguments.length;a<f;a++){b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d};return F.apply(this,arguments)},G=function(d){function b(a,f,c,h,g,e){void 0===g&&(g=!1);void 0===e&&(e=b.POLLING_FREQUENCY);var k=d.call(this,a,f,c,h)||this;a.addEventListener(b.UPDATE_NOTIFICATION_EVENT,function(){k.trigger()});g&&p.queueTaskEvery(function(){k.trigger()},
e);k.trigger();return k}U(b,d);b.update=function(a){var f=new CustomEvent(b.UPDATE_NOTIFICATION_EVENT,{bubbles:!1,cancelable:!1});a.dispatchEvent(f)};b.prototype.collect=function(a){var f=a.querySelectorAll(b.QUERY_SELECTOR),c={};a=function(a){a=f[a];var e=F({},a.dataset),g=e[b.ATTR_TARGET];a.classList.remove(b.RENDERING_HINTS_CLASS);if(!g)return"continue";var h=d.getAbsoluteUrl(g);c[h]=c[h]||{};Object.keys(e).filter(function(a){return!!e[a]&&a!==b.ATTR_QUERY&&a!==b.ATTR_TARGET}).forEach(function(a){c[h][a]=
e[a]})};for(var d=this,g=0;g<f.length;g++)a(g);return c};b.prototype.logCount=function(a,b){d.prototype.logCount.call(this,"DDHC:"+a,b)};b.RENDERING_HINTS_CLASS="lightsaber-rendering-hints";b.QUERY_SELECTOR='div[data-lightsaber\x3d"rendering-hints/speculated-navigation-content"].'+b.RENDERING_HINTS_CLASS;b.ATTR_QUERY="lightsaber";b.ATTR_TARGET="target";b.UPDATE_NOTIFICATION_EVENT="lightsaber:rendering-hints:declarative-dataset:update";b.POLLING_FREQUENCY=3E3;return b}(D),V=this&&this.__extends||function(){var d=
function(b,a){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return d(b,a)};return function(b,a){function f(){this.constructor=b}d(b,a);b.prototype=null===a?Object.create(a):(f.prototype=a.prototype,new f)}}(),W=function(d){function b(a,b,c,h,g,e){var f=d.call(this,a,b,c,e)||this;if(!g.capabilities.mobile)return f;h.when("Rush","s-web-application-controller").execute(function(b,c){b.on(c.ACTIONS.LOAD_SEARCH_PAGE_COMPLETE,
function(){f.trigger();G.update(a)})});f._previouslySeenTargets={};f.trigger();return f}V(b,d);b.prototype.collect=function(a){a=a.querySelectorAll(b.FACEOUT_IMAGE_QUERY);for(var f={},c=0;c<a.length;c++){var d=a[c],g=d.closest("a");g&&(g=g.href,this._previouslySeenTargets[g]||(this._previouslySeenTargets[g]=!0,f[g]={faceoutImage:d.src,productTitle:d.alt}))}this.logCount("Query",Object.keys(f).length);return f};b.prototype.logCount=function(a,b){d.prototype.logCount.call(this,"SPHC:"+a,b)};b.FACEOUT_IMAGE_QUERY=
'a.s-faceout-link img.s-image[data-image-latency\x3d"s-product-image"]';return b}(D),X=this&&this.__extends||function(){var d=function(b,a){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return d(b,a)};return function(b,a){function f(){this.constructor=b}d(b,a);b.prototype=null===a?Object.create(a):(f.prototype=a.prototype,new f)}}(),Y=this&&this.__awaiter||function(d,b,a,f){function c(b){return b instanceof
a?b:new a(function(a){a(b)})}return new (a||(a=Promise))(function(a,g){function e(a){try{l(f.next(a))}catch(m){g(m)}}function h(a){try{l(f["throw"](a))}catch(m){g(m)}}function l(b){b.done?a(b.value):c(b.value).then(e,h)}l((f=f.apply(d,b||[])).next())})},Z=this&&this.__generator||function(d,b){function a(a){return function(b){return f([a,b])}}function f(a){if(h)throw new TypeError("Generator is already executing.");for(;c;)try{if(h=1,g&&(e=a[0]&2?g["return"]:a[0]?g["throw"]||((e=g["return"])&&e.call(g),
0):g.next)&&!(e=e.call(g,a[1])).done)return e;if(g=0,e)a=[a[0]&2,e.value];switch(a[0]){case 0:case 1:e=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++;g=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(e=c.trys,e=0<e.length&&e[e.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!e||a[1]>e[0]&&a[1]<e[3]))c.label=a[1];else if(6===a[0]&&c.label<e[1])c.label=e[1],e=a;else if(e&&c.label<e[2])c.label=e[2],c.ops.push(a);else{e[2]&&c.ops.pop();c.trys.pop();
continue}}a=b.call(d,c)}catch(r){a=[6,r],g=0}finally{h=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var c={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,e,k;return k={next:a(0),"throw":a(1),"return":a(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k};D=function(d){function b(a,b,c,h){a=d.call(this,a,b,c)||this;a._queryRoot=h;return a}X(b,d);b.prototype.trigger=function(){var a=this;p.queueTask(function(){return Y(a,void 0,
void 0,function(){var a;return Z(this,function(c){switch(c.label){case 0:return[4,p.waitTillIdleOrTimeout(b._IDLE_TIMEOUT)];case 1:return c.sent(),this.ready()?[4,this.collect(this._queryRoot)]:(this.logCount("NotReady"),[2]);case 2:return a=c.sent(),this._send(a),[2]}})})})};b.prototype.logCount=function(a,b){d.prototype.logCount.call(this,"PAHC:"+a,b)};b.prototype._send=function(a){a=[{nature:b._RENDERING_HINTS_NATURE,data:a,source:this._getSource()}];this.logCount("Targets");this.sendToWorker(a)};
b.prototype._getSource=function(){return{url:this.global.location.href,pty:t.getPageType(this.global),spty:t.getSubPageType(this.global),rid:t.getRequestId(this.global)}};b._IDLE_TIMEOUT=1E3;b._RENDERING_HINTS_NATURE="page_attributes";return b}(A);var aa=this&&this.__extends||function(){var d=function(b,a){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return d(b,a)};return function(b,a){function f(){this.constructor=
b}d(b,a);b.prototype=null===a?Object.create(a):(f.prototype=a.prototype,new f)}}(),H=this&&this.__awaiter||function(d,b,a,f){function c(b){return b instanceof a?b:new a(function(a){a(b)})}return new (a||(a=Promise))(function(a,g){function e(a){try{l(f.next(a))}catch(m){g(m)}}function h(a){try{l(f["throw"](a))}catch(m){g(m)}}function l(b){b.done?a(b.value):c(b.value).then(e,h)}l((f=f.apply(d,b||[])).next())})},I=this&&this.__generator||function(d,b){function a(a){return function(b){return f([a,b])}}
function f(a){if(h)throw new TypeError("Generator is already executing.");for(;c;)try{if(h=1,g&&(e=a[0]&2?g["return"]:a[0]?g["throw"]||((e=g["return"])&&e.call(g),0):g.next)&&!(e=e.call(g,a[1])).done)return e;if(g=0,e)a=[a[0]&2,e.value];switch(a[0]){case 0:case 1:e=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++;g=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(e=c.trys,e=0<e.length&&e[e.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&
(!e||a[1]>e[0]&&a[1]<e[3]))c.label=a[1];else if(6===a[0]&&c.label<e[1])c.label=e[1],e=a;else if(e&&c.label<e[2])c.label=e[2],c.ops.push(a);else{e[2]&&c.ops.pop();c.trys.pop();continue}}a=b.call(d,c)}catch(r){a=[6,r],g=0}finally{h=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var c={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,e,k;return k={next:a(0),"throw":a(1),"return":a(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),
k},ba=function(d){function b(a,b,c,h,g){a=d.call(this,a,b,c,a.document)||this;if(n.isTabletDevice(h)||n.isDesktopDevice(h))return a;a.A=h;a.P=g;a.trigger();return a}aa(b,d);b.prototype.collect=function(a){return H(this,void 0,void 0,function(){var b,c,d;return I(this,function(f){switch(f.label){case 0:return b={},n.isDesktopDevice(this.A)?[4,this._getWDGFromImageBlock()]:[3,2];case 1:return c=f.sent(),[3,3];case 2:c=this._getWDGFromUSS(a),f.label=3;case 3:return c||(c=this._getWDGFromAODScript(a)),
c||(c=this._getWDGFromDPContainer(a)),c?b.wdg=c:this.logCount("WDG:NONE"),[4,this._getLCPImageUrl()];case 4:return(d=f.sent())?b.lcpImage=d:this.logCount("LCP:NONE"),[2,b]}})})};b.prototype._getImageBlockMainImageId=function(){return n.isDesktopDevice(this.A)?b._IMAGE_BLOCK_MAIN_IMAGE_ID_DESKTOP:b._IMAGE_BLOCK_MAIN_IMAGE_ID_MOBILE};b.prototype._getWDGFromImageBlock=function(){return H(this,void 0,void 0,function(){var a,f=this;return I(this,function(c){switch(c.label){case 0:return[4,Promise.race([new Promise(function(a){f.P.when("ImageBlockBTF").execute(function(b){try{(null===
b||void 0===b?0:b.productGroupID)?(f.logCount("WDG:IMAGEBLOCK"),a(b.productGroupID)):(f.logCount("WDG:IMAGEBLOCK:MISSING"),a(q))}catch(e){f.logCount("WDG:IMAGEBLOCK:ERROR"),f.logError(e,{logLevel:"WARN",message:"Failed to process WDG from ImageBlock module."}),a(q)}})}),p.wait(b._WDG_IMAGEBLOCK_TIMEOUT).then(function(){return"timeout"})])];case 1:return a=c.sent(),"timeout"===a?(this.logCount("WDG:IMAGEBLOCK:TIMEOUT"),[2,q]):[2,a]}})})};b.prototype._getWDGFromUSS=function(a){if((a=a.querySelector(b._USS_SELECTOR))&&
a.value)return this.logCount("WDG:USS"),a.value};b.prototype._getWDGFromAODScript=function(a){if((a=a.querySelector(b._AOD_SCRIPT_SELECTOR))&&(a=a.textContent)&&(a=a.match(b._AOD_SCRIPT_REGEXP))&&a[1])return this.logCount("WDG:AOD"),a[1]};b.prototype._getWDGFromDPContainer=function(a){if(a=a.querySelector(b._DP_CONTAINER_SELECTOR))if(a=a.className.trim().split(" ")[0]){var f=a,c=b._WDG_MOBILE_CLASS_SUFFIX;z.endsWith(a,c)&&(f=a.substring(0,a.length-c.length));this.logCount("WDG:CID");return""+f+b._WDG_SUFFIX}};
b.prototype._getLCPImageUrl=function(){return H(this,void 0,void 0,function(){var a,f,c,d=this;return I(this,function(g){switch(g.label){case 0:a=function(a){var b=u.isObject,c=u.isNonEmptyString;return!(!b(a)||a.id!==d._getImageBlockMainImageId()||!c(a.url))},g.label=1;case 1:return g.trys.push([1,3,,4]),[4,Promise.race([B.getMatchingEntry(a),p.wait(b._LCP_RESOLUTION_TIMEOUT).then(function(){return"timeout"})])];case 2:f=g.sent();if("timeout"===f)return this.logCount("LCPT"),[2];this.logCount("LCPI");
return[2,f?f.url:q];case 3:return c=g.sent(),this.logCount("LCPE"),this.logError(c,{logLevel:"WARN",message:"Failed to fetch LCP image."}),[2];case 4:return[2]}})})};b._DP_CONTAINER_SELECTOR="#dp";b._USS_SELECTOR="input#uss-mraiCategory";b._AOD_SCRIPT_SELECTOR="#all-offers-display ~ script";b._AOD_SCRIPT_REGEXP=/AOD assets for WDG:\s*(\w+)/;b._IMAGE_BLOCK_MAIN_IMAGE_ID_MOBILE="main-image";b._IMAGE_BLOCK_MAIN_IMAGE_ID_DESKTOP="landingImage";b._LCP_RESOLUTION_TIMEOUT=1E3;b._WDG_IMAGEBLOCK_TIMEOUT=2E3;
b._WDG_MOBILE_CLASS_SUFFIX="_mobile";b._WDG_SUFFIX="_display_on_website";return b}(D),ca=this&&this.__extends||function(){var d=function(b,a){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return d(b,a)};return function(b,a){function f(){this.constructor=b}d(b,a);b.prototype=null===a?Object.create(a):(f.prototype=a.prototype,new f)}}(),da=this&&this.__awaiter||function(d,b,a,f){function c(b){return b instanceof
a?b:new a(function(a){a(b)})}return new (a||(a=Promise))(function(a,g){function e(a){try{l(f.next(a))}catch(m){g(m)}}function h(a){try{l(f["throw"](a))}catch(m){g(m)}}function l(b){b.done?a(b.value):c(b.value).then(e,h)}l((f=f.apply(d,b||[])).next())})},ea=this&&this.__generator||function(d,b){function a(a){return function(b){return f([a,b])}}function f(a){if(h)throw new TypeError("Generator is already executing.");for(;c;)try{if(h=1,g&&(e=a[0]&2?g["return"]:a[0]?g["throw"]||((e=g["return"])&&e.call(g),
0):g.next)&&!(e=e.call(g,a[1])).done)return e;if(g=0,e)a=[a[0]&2,e.value];switch(a[0]){case 0:case 1:e=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++;g=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(e=c.trys,e=0<e.length&&e[e.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!e||a[1]>e[0]&&a[1]<e[3]))c.label=a[1];else if(6===a[0]&&c.label<e[1])c.label=e[1],e=a;else if(e&&c.label<e[2])c.label=e[2],c.ops.push(a);else{e[2]&&c.ops.pop();c.trys.pop();
continue}}a=b.call(d,c)}catch(r){a=[6,r],g=0}finally{h=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var c={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,e,k;return k={next:a(0),"throw":a(1),"return":a(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k},fa=function(d){function b(a,b,c,h){var f=d.call(this,a,b,c)||this;f._previouslySeen=new Set;f._buffer=[];f._pendingBufferLength=0;f._queryRoot=h;f._targetPrefix=a.location.origin;
f._observer=new MutationObserver(function(a){f._handleMutations(a)});f.trigger();return f}ca(b,d);b.prototype.trigger=function(){var a=this;p.queueTask(function(){return da(a,void 0,void 0,function(){return ea(this,function(a){switch(a.label){case 0:return[4,p.waitTillIdleOrTimeout(b._IDLE_TIMEOUT)];case 1:a.sent();if(!this.ready())return this._logCount("NotReady"),[2];this._collectAnchorTags(this._queryRoot,!0);this._observer.observe(this._queryRoot,{childList:!0,subtree:!0});return[2]}})})})};b.prototype._collectAnchorTags=
function(a,f){var c=performance.now();a=a.querySelectorAll(b._ANCHOR_SELECTOR);for(var d=0;d<a.length;d++)this._addTarget(a[d].href);c=performance.now()-c;this._logCount((f?"InitialScan":"")+"TimeToCollectHintsDuration",c);this._queueSend()};b.prototype._handleMutations=function(a){var b=this;a.filter(function(a){return"childList"===a.type}).forEach(function(a){Array.from(a.addedNodes).forEach(function(a){if(a instanceof HTMLElement||a instanceof DocumentFragment)a instanceof HTMLAnchorElement?(b._addTarget(a.href),
b._queueSend()):b._collectAnchorTags(a)})})};b.prototype._addTarget=function(a){a&&0===a.indexOf(this._targetPrefix)&&!this._previouslySeen.has(a)&&(this._previouslySeen.add(a),this._buffer.push(a))};b.prototype._queueSend=function(){var a=this;if(1>this._buffer.length)this._pendingBufferLength=0;else{if(this._pendingSend){if(this._buffer.length<=this._pendingBufferLength)return;p.clearQueuedTask(this._pendingSend)}this._pendingSend=p.queueTask(function(){a._send(a._buffer.slice());a._pendingBufferLength=
a._buffer.length=0;a._pendingSend=q},b._SEND_DEBOUNCE_MS);this._pendingBufferLength=this._buffer.length}};b.prototype._send=function(a){if(0!==a.length){var f=[{nature:b._RENDERING_HINTS_NATURE,data:{targets:a},source:this._getSource()}];this._logCount("Targets",a.length);this.sendToWorker(f)}};b.prototype._logCount=function(a,b){d.prototype.logCount.call(this,"NTHC:"+a,b)};b.prototype._getSource=function(){return{url:this.global.location.href,pty:t.getPageType(this.global),spty:t.getSubPageType(this.global),
rid:t.getRequestId(this.global)}};b._IDLE_TIMEOUT=1E3;b._RENDERING_HINTS_NATURE="navigation_targets";b._ANCHOR_SELECTOR="a[href]";b._SEND_DEBOUNCE_MS=100;return b}(A);A=function(){function d(b,a,d,c){var f=this;this.global=b;this.csmLogger=a;this.P=d;this.A=c;"complete"===b.document.readyState?this.survey():b.addEventListener("load",function(){f.survey()})}d.prototype.getResourceTimingRecords=function(b){var a=this.global.performance.getEntriesByType("resource");return"function"===typeof b?a.filter(b):
a};d.prototype.getServerTimingRecords=function(){var b=this.global.performance.getEntriesByType("navigation")[0];return b&&b.serverTiming?b.serverTiming.filter(function(a){return a.name===d._SERVER_TIMING_NAME}).map(function(a){if(a.description)try{return JSON.parse(decodeURIComponent(a.description))}catch(f){}}).filter(function(a){return!!a}):[]};d.prototype.getEpochForPerformanceTimeline=function(b){return Math.round(this.global.performance.timeOrigin+b)};d.prototype.logTag=function(b){this.csmLogger.tag(this._getMetricName(b))};
d.prototype.logCount=function(b,a){this.csmLogger.count(this._getMetricName(b),a)};d.prototype.logWidgetLatency=function(b,a,d){a=this._getMetricName(a);this.csmLogger.widgetLatency(b,a,d)};d.prototype.logError=function(b,a){this.csmLogger.logError(b,a)};d.prototype._getMetricName=function(b){return"RenderingHints:Survey:"+b};d._SERVER_TIMING_NAME="lightsaber";return d}();var v;(function(d){d.Hostname="hostname";d.Prefix="prefix";d.PhysicalId="physicalId";d.Suffix="suffix"})(v||(v={}));var ha=this&&
this.__extends||function(){var d=function(b,a){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return d(b,a)};return function(b,a){function f(){this.constructor=b}d(b,a);b.prototype=null===a?Object.create(a):(f.prototype=a.prototype,new f)}}(),J=this&&this.__awaiter||function(d,b,a,f){function c(b){return b instanceof a?b:new a(function(a){a(b)})}return new (a||(a=Promise))(function(a,g){function e(a){try{l(f.next(a))}catch(m){g(m)}}
function h(a){try{l(f["throw"](a))}catch(m){g(m)}}function l(b){b.done?a(b.value):c(b.value).then(e,h)}l((f=f.apply(d,b||[])).next())})},K=this&&this.__generator||function(d,b){function a(a){return function(b){return f([a,b])}}function f(a){if(h)throw new TypeError("Generator is already executing.");for(;c;)try{if(h=1,g&&(e=a[0]&2?g["return"]:a[0]?g["throw"]||((e=g["return"])&&e.call(g),0):g.next)&&!(e=e.call(g,a[1])).done)return e;if(g=0,e)a=[a[0]&2,e.value];switch(a[0]){case 0:case 1:e=a;break;
case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++;g=a[1];a=[0];continue;case 7:a=c.ops.pop();c.trys.pop();continue;default:if(!(e=c.trys,e=0<e.length&&e[e.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!e||a[1]>e[0]&&a[1]<e[3]))c.label=a[1];else if(6===a[0]&&c.label<e[1])c.label=e[1],e=a;else if(e&&c.label<e[2])c.label=e[2],c.ops.push(a);else{e[2]&&c.ops.pop();c.trys.pop();continue}}a=b.call(d,c)}catch(r){a=[6,r],g=0}finally{h=e=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:
void 0,done:!0}}var c={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,e,k;return k={next:a(0),"throw":a(1),"return":a(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k},ia=function(d){function b(){return null!==d&&d.apply(this,arguments)||this}ha(b,d);b.prototype.survey=function(){return J(this,void 0,void 0,function(){return K(this,function(a){switch(a.label){case 0:return[4,this._surveyLCPImagePreload()];case 1:return a.sent(),[2]}})})};
b.prototype._getImageBlockMainImageId=function(){return n.isDesktopDevice(this.A)?b._IMAGE_BLOCK_MAIN_IMAGE_ID_DESKTOP:b._IMAGE_BLOCK_MAIN_IMAGE_ID_MOBILE};b.prototype._surveyLCPImagePreload=function(){return J(this,void 0,void 0,function(){var a,d;return K(this,function(c){switch(c.label){case 0:return[4,this._getLCPImageUrl()];case 1:a=c.sent();if(!a)return this._logCount("LCP:ImageNotFound",1),[2];d=this._getPreloadedUrlRecord(b._RECORD_PURPOSE_PREFIX+":LCP");if(!d)return this._logCount("LCP:HintNotFound",
1),[2];this._logMatch("LCP",a,d.href,d.attribution);return[2]}})})};b.prototype._getLCPImageUrl=function(){return J(this,void 0,void 0,function(){var a,d,c,h=this;return K(this,function(f){switch(f.label){case 0:a=function(a){var b=u.isObject,c=u.isNonEmptyString;return!(!b(a)||a.id!==h._getImageBlockMainImageId()||!c(a.url))},f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Promise.race([B.getMatchingEntry(a),p.wait(b._LCP_RESOLUTION_TIMEOUT).then(function(){return"timeout"})])];case 2:return d=
f.sent(),"timeout"===d?(this._logCount("LCP:LCPTimeout",1),[2]):[2,d?d.url:q];case 3:return c=f.sent(),this.logError(c,{logLevel:"WARN",message:"LCP Error."}),this._logCount("LCP:LCPError",1),[2];case 4:return[2]}})})};b.prototype._getPreloadedUrlRecord=function(a){var d=this.getServerTimingRecords().filter(function(c){return c.role===b._RECORD_ROLE&&c.purpose===a.toLowerCase()&&c.as===b._RECORD_AS});return 0<d.length?d[0]:q};b.prototype._logMatch=function(a,b,c,d){var f=this._hitOrMiss(c===b);this._logCount(a+
":"+f,1);d&&this._logCount(a+":"+f+":"+d,1);c!==b&&(this._logURLMismatchDetails(b,c),this._logImageUrlComponentMismatches(a,b,c))};b.prototype._checkComponentAvailability=function(a,b,c,d){var f=z.capitalizeFirstChar(d);b[d]||this._logCount(a+":Image"+f+"Unavailable",1);c[d]||this._logCount(a+":Preloaded"+f+"Unavailable",1)};b.prototype._checkComponentMismatch=function(a,b,c,d){return(b[d]||c[d])&&b[d]!==c[d]?(this._logCount(a+":"+z.capitalizeFirstChar(d)+"Mismatch",1),!0):!1};b.prototype._logImageUrlComponentMismatches=
function(a,b,c){var d;b=C.parseImageURL(b);var f=C.parseImageURL(c);if(b&&f){c=(d={},d[v.PhysicalId]=!1,d[v.Hostname]=!1,d[v.Suffix]=!1,d[v.Prefix]=!1,d);for(var e=0,k=Object.keys(v);e<k.length;e++)d=k[e],d=v[d],this._checkComponentAvailability(a,b,f,d),c[d]=this._checkComponentMismatch(a,b,f,d);b="";e=f=0;for(k=Object.keys(v);e<k.length;e++)d=k[e],d=v[d],c[d]&&(b+=z.capitalizeFirstChar(d),f++);""!==b&&1<f&&this._logCount(a+":"+b+"Mismatch",1)}else b||this._logCount(a+":ImageUnexpectedURL",1),f||
this._logCount(a+":PreloadedUnexpectedURL",1)};b.prototype._logCount=function(a,d){this.logCount(b._METRIC_PREFIX+":"+a,d)};b.prototype._hitOrMiss=function(a){return a?"Hit":"Miss"};b.prototype._logURLMismatchDetails=function(a,b){this.logError(Error("Found URL mismatch between preloaded and LCP image URL. "+("Preload URL: "+b+" and Image URL: "+a)),{logLevel:"WARN"})};b._RECORD_ROLE="rendering-hints/preload";b._RECORD_PURPOSE_PREFIX="detail-landing-image";b._RECORD_AS="image";b._METRIC_PREFIX="DetailLandingImagePreload";
b._IMAGE_BLOCK_MAIN_IMAGE_ID_MOBILE="main-image";b._IMAGE_BLOCK_MAIN_IMAGE_ID_DESKTOP="landingImage";b._LCP_RESOLUTION_TIMEOUT=1E3;return b}(A),ja=function(){function d(b,a,d,c,h){this._global=b;this._P=a;this._A=d;this._workerMessaging=c;this._csmLogger=h}d.prototype.start=function(){switch(t.getPageTypeGroup(this._global)){case "Search":var b=document.getElementById("search");new G(this._global,this._workerMessaging,this._csmLogger,b);new W(this._global,this._workerMessaging,this._csmLogger,this._P,
this._A,b);break;case "Detail":b=document.getElementById("dp"),new ba(this._global,this._workerMessaging,this._csmLogger,this._A,this._P),new G(this._global,this._workerMessaging,this._csmLogger,b),new ia(this._global,this._csmLogger,this._P,this._A)}(n.isSupportedAndroidMshopClient(this._A)||(n.isSupportedDesktopClient(this._A),0)||n.isSupportedMobileWebBrowserClient(this._A))&&new fa(this._global,this._workerMessaging,this._csmLogger,document.body)};return d}();(function(){function d(b){this._hit=
!(!b.$Lightsaber||!b.$Lightsaber.hit);try{var a=b.$Lightsaber&&b.$Lightsaber.meta?E.deep(b.$Lightsaber.meta):q;this._meta=this._isValid(a)?a:q}catch(f){this._meta=q}}d.prototype.isHit=function(){return this._hit};d.prototype.getMeta=function(){return this._meta};d.prototype._isValid=function(b){var a=u.isObject,d=u.isNonEmptyString,c=u.isPositiveInteger;return!!(b&&a(b)&&c(b.fetchEventTimeOrigin)&&d(b.navigationRule)&&a(b.responseStrategy)&&d(b.responseStrategy.name)&&a(b.clientLib)&&d(b.clientLib.version))};
return d})();var ka=function(){function d(b){this._global=b}d.prototype.send=function(b,a){b={feature:d.FEATURE,command:b,options:a};(a=this._getCurrentController())?(y.log("ServiceWorker:PostMessage:",b),a.postMessage(b)):y.log("ServiceWorker:Unavailable:",b)};d.prototype.ready=function(){return!!this._getCurrentController()};d.prototype._getCurrentController=function(){if(this._global&&this._global.navigator&&this._global.navigator.serviceWorker&&this._global.navigator.serviceWorker.controller&&
u.isFunction(this._global.navigator.serviceWorker.controller.postMessage))return this._global.navigator.serviceWorker.controller};d.FEATURE="lightsaber";return d}();(function(){w.when("A").execute("lightsaber:page",function(d){var b=new P(x),a=new ka(x);b.count("AssetLoaded");w.now().register("lightsaber:page:rendering-metrics",function(){});w.when("ready").register("lightsaber:page:rendering-hints",function(){(new ja(x,w,d,a,b)).start()})})})()})()});